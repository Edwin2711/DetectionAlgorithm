This is the full code in .py format.
